<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Staff — Venus Lealtad</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    .staff-wrap{max-width:1050px;margin:24px auto;padding:16px}
    .staff-grid{display:grid;grid-template-columns:1.2fr .8fr;gap:18px}
    .panel{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    .panel h2{margin-top:0}
    video{width:100%;border-radius:10px;background:#000;aspect-ratio:16/9;object-fit:cover}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .muted{color:#6b7280}
    .ok{color:#15803d}.err{color:#b91c1c}
    .stamp-preview{display:grid;grid-template-columns:repeat(auto-fill,minmax(28px,1fr));gap:8px;margin-top:10px}
    .stamp-pip{position:relative;width:28px;height:28px;border-radius:50%;background:#eef2f7;border:1px solid #e5e7eb;overflow:hidden}
    .stamp-pip.full{background-image:url('/assets/stamp.png');background-size:cover;background-position:center;background-color:transparent;border:none}
    .idline{display:flex;gap:8px;align-items:center;margin-top:6px}
    .btn{display:inline-flex;align-items:center;gap:8px;background:#8c9668;border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn-ghost{background:transparent;border:1px solid #d1d5db;color:#111}
    .hidden { display: none !important; }

    /* === Animación de "pulso" para el sello recién agregado === */
    @keyframes stampPulse {
      0%   { transform: scale(0.6); box-shadow: 0 0 0 0 rgba(140,150,104,0.00); opacity: 0.2; }
      40%  { transform: scale(1.08); box-shadow: 0 0 0 6px rgba(140,150,104,0.15); opacity: 1; }
      100% { transform: scale(1.00); box-shadow: 0 0 0 0 rgba(140,150,104,0.00); opacity: 1; }
    }
    .stamp-pip.full.pulse {
      animation: stampPulse 600ms ease-out;
      will-change: transform, box-shadow, opacity;
    }
  </style>
</head>
<body>
  <main class="staff-wrap">
    <header class="row" style="justify-content:space-between">
      <div class="row">
        <img src="/assets/logo.png" alt="Venus" style="width:40px;height:40px;border-radius:10px">
        <div>
          <h1 style="margin:0">Venus Lealtad — Staff</h1>
          <div class="muted" style="margin-top:2px">Escanea QR del cliente para sumar sello</div>
        </div>
      </div>
      <a class="btn btn-ghost" href="/" target="_blank" rel="noopener">Ver página de clientes</a>
    </header>

    <section class="staff-grid">
      <!-- Cámara / Escáner -->
      <div class="panel">
        <h2>Escáner</h2>
        <div class="row">
          <select id="camera"></select>
          <button id="start" class="btn">Iniciar cámara</button>
          <button id="stop" class="btn btn-ghost" disabled>Detener</button>
          <button id="switch" class="btn btn-ghost" disabled>Cambiar cámara</button>
        </div>
        <div style="margin-top:10px">
          <video id="video" playsinline muted></video>
        </div>

        <details style="margin-top:12px">
          <summary>Ingresar cardId manualmente</summary>
          <div class="row" style="margin-top:8px">
            <input id="manual" placeholder="card_..." style="flex:1;padding:10px;border:1px solid #e5e7eb;border-radius:10px">
            <button id="load" class="btn">Cargar</button>
          </div>
        </details>

        <div id="scan-out" class="muted" style="margin-top:10px"></div>
      </div>

      <!-- Detalles de la tarjeta -->
      <div class="panel">
        <h2>Tarjeta</h2>
        <div id="card-empty" class="muted">Aún no hay tarjeta cargada.</div>

        <div id="card-box" class="hidden">
          <div class="row" style="justify-content:space-between">
            <div>
              <div class="muted small">Cliente</div>
              <h3 id="c_name" style="margin:.2rem 0 0"></h3>
              <div class="muted"><span id="c_count"></span></div>
            </div>
            <img src="/assets/hero.png" alt="Hero" style="width:84px;border-radius:10px">
          </div>

          <div class="stamp-preview" id="c_grid"></div>

          <div class="idline">
            <code id="c_id"></code>
            <button id="copy" class="btn btn-ghost">Copiar ID</button>
          </div>

          <div class="row" style="margin-top:12px">
            <button id="stamp" class="btn">Sumar sello (+1)</button>
            <button id="redeem" class="btn btn-ghost">Canjear premio</button>
          </div>

          <div id="card-out" class="muted" style="margin-top:8px"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Fallback para lectura QR si no hay BarcodeDetector -->
  <script>
    window.__NEED_JSQR__ = !('BarcodeDetector' in window);
    if(window.__NEED_JSQR__){
      const s=document.createElement('script');
      s.src='https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js';
      document.head.appendChild(s);
    }
  </script>
  <script src="/staff.js"></script>
</body>
</html>