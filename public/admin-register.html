<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crear cuenta — Panel Admin Venus</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    .shell{max-width:860px;margin:24px auto;padding:16px}
    .card{background:#fff;border:1px solid #e9e9e9;border-radius:16px;padding:20px}
    .h1{display:flex;align-items:center;gap:10px;margin:0 0 10px}
    .muted{color:#6b6b6b}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .field{width:100%;padding:12px 14px;border:1px solid #ddd;border-radius:12px;background:#fafafa}
    .btn{background:#8c9668;color:#fff;border:none;border-radius:12px;padding:12px 16px;cursor:pointer}
    .btn-ghost{background:#fff;color:#8c9668;border:1px solid #8c9668}
    .out{margin-top:10px}
    .out.err{color:#b91c1c}
    .out.ok{color:#15803d}
    .top-links{display:flex;gap:10px;justify-content:flex-end;margin-bottom:12px}
  </style>
</head>
<body>
  <main class="shell">
    <div class="top-links">
      <a class="btn-ghost btn" href="/" rel="noopener">Página clientes</a>
      <a class="btn-ghost btn" href="/staff.html" rel="noopener">Página staff</a>
    </div>

    <h1 class="h1">
      <img src="/assets/logo.png" alt="Venus" style="width:36px;height:36px;border-radius:8px;border:1px solid #e9e9e9">
      <span>Crear cuenta de administrador</span>
    </h1>
    <p class="muted">Regístrate para administrar tarjetas y eventos. Si ya tienes cuenta, <a href="/admin-login.html">inicia sesión aquí</a>.</p>

    <section class="card">
      <form id="reg-form">
        <label>
          <div class="muted">Email</div>
          <input id="email" type="email" class="field" required autocomplete="username">
        </label>
        <label style="margin-top:10px">
          <div class="muted">Contraseña</div>
          <input id="pass" type="password" class="field" required autocomplete="new-password" minlength="6">
        </label>

        <div class="row" style="margin-top:12px;justify-content:space-between">
          <a class="btn-ghost btn" href="/admin-login.html">Ya tengo cuenta</a>
          <button class="btn" type="submit">Crear cuenta</button>
        </div>
        <div id="out" class="out muted"></div>
      </form>
    </section>
  </main>

  <script>
    const $ = s => document.querySelector(s);
    $("#reg-form").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = $("#email").value.trim();
      const password = $("#pass").value;

      $("#out").textContent = "Enviando...";
      $("#out").className = "out muted";

      try{
        const r = await fetch("/api/admin/register", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ email, password })
        });
        const data = await r.json();
        if(!r.ok){
          if(data.error === "signup_disabled"){
            throw new Error("El registro está deshabilitado por el servidor.");
          }
          if(data.error === "email_in_use"){
            throw new Error("Ese correo ya está en uso.");
          }
          throw new Error(data.error || "No se pudo registrar.");
        }
        $("#out").textContent = "Cuenta creada. Ahora inicia sesión.";
        $("#out").className = "out ok";
        setTimeout(()=> location.href="/admin-login.html", 800);
      }catch(err){
        $("#out").textContent = err.message;
        $("#out").className = "out err";
      }
    });
  </script>
</body>
</html>
