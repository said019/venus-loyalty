<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Panel Admin ‚Äî Venus Lealtad</title>
  <link rel="icon" href="/assets/logo.png">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <!-- Estilos personalizados -->
  <style>
    :root{
      --venus:#8c9668;
      --venus-soft:#dfe6c1;
      --bg:#3f4037;
      --ink:#f9fafb;
      --muted:#e5e7eb;
      --line:rgba(255,255,255,0.25);
      --radius:18px;
      --success: #10b981;
      --danger: #ef4444;
    }
    
    body {
      background-color: var(--bg);
      color: var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Inter, Roboto, Arial, sans-serif;
      min-height: 100vh;
    }
    
    body.checking-auth {
      opacity: 0;
      pointer-events: none;
    }

    body.auth-verified {
      opacity: 1;
      transition: opacity 0.3s ease;
    }
    
    .navbar-custom {
      background-color: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }
    
    .card-custom {
      background: rgba(255,255,255,.08);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      box-shadow: 0 10px 28px rgba(0,0,0,.2);
      backdrop-filter: blur(3px);
      position: relative;
      overflow: hidden;
    }
    
    .card-custom::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.05), transparent 60%),
        radial-gradient(circle at 80% 70%, rgba(255,255,255,0.03), transparent 60%);
      opacity: .9;
      pointer-events: none;
    }
    
    .card-custom > * {
      position: relative;
      z-index: 1;
    }
    
    .btn-venus {
      background-color: var(--venus);
      border-color: var(--venus);
      color: white;
    }
    
    .btn-venus:hover {
      background-color: #7a855d;
      border-color: #7a855d;
      color: white;
    }
    
    .btn-outline-venus {
      color: var(--venus);
      border-color: var(--venus);
    }
    
    .btn-outline-venus:hover {
      background-color: var(--venus);
      color: white;
    }
    
    .kpi-card {
      background: rgba(255,255,255,.1);
      border: 1px solid rgba(255,255,255,.15);
      border-radius: 12px;
      padding: 1rem;
      backdrop-filter: blur(3px);
    }
    
    .kpi-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--ink);
    }
    
    .kpi-label {
      color: var(--muted);
      font-size: 0.875rem;
    }
    
    .nav-pills-custom .nav-link {
      color: var(--muted);
      border-radius: 50px;
      padding: 0.5rem 1rem;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .nav-pills-custom .nav-link.active {
      background-color: rgba(255,255,255,.15);
      border-color: var(--venus);
      color: var(--venus-soft);
      box-shadow: 0 4px 14px rgba(0,0,0,.1);
    }
    
    .table-custom {
      color: var(--ink);
      --bs-table-bg: transparent;
      --bs-table-border-color: rgba(255,255,255,.1);
    }
    
    .table-custom thead th {
      background-color: rgba(255,255,255,.1);
      border-bottom: 1px solid rgba(255,255,255,.1);
    }
    
    .table-custom tbody tr {
      border-bottom: 1px solid rgba(255,255,255,.05);
    }
    
    .form-control-custom, .form-select-custom {
      background-color: rgba(255,255,255,.1);
      border: 1px solid var(--line);
      color: var(--ink);
    }
    
    .form-control-custom:focus, .form-select-custom:focus {
      background-color: rgba(255,255,255,.15);
      border-color: var(--venus);
      color: var(--ink);
      box-shadow: 0 0 0 0.25rem rgba(140, 150, 104, 0.25);
    }
    
    .modal-custom .modal-content {
      background-color: #111827;
      color: var(--ink);
      border: 1px solid var(--line);
      border-radius: 24px;
    }
    
    .modal-custom .modal-header {
      border-bottom: 1px solid var(--line);
    }
    
    .modal-custom .modal-footer {
      border-top: 1px solid var(--line);
    }
    
    .gift-card-visual {
      background-color: #8c9668;
      border-radius: 20px;
      color: #fff;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      width: 100%;
      max-width: 320px;
      position: relative;
      overflow: hidden;
      text-align: center;
      margin: 0 auto;
      font-family: 'Poppins', sans-serif;
    }

    .gift-card-visual::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 30%, rgba(255,255,255,0.05), transparent 70%),
                  radial-gradient(circle at 80% 60%, rgba(255,255,255,0.04), transparent 60%);
      opacity: 0.7;
      z-index: 0;
    }

    .gift-card-content {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .gift-brand-logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #fff;
      margin-bottom: 10px;
      box-shadow: 0 0 10px rgba(255,255,255,0.3);
      object-fit: contain;
      padding: 2px;
    }

    .gift-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 5px 0;
    }

    .gift-service {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 10px 0 5px;
      color: #dfe6c1;
    }

    .gift-meta {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .gift-qr-container {
      background: #fff;
      padding: 10px;
      border-radius: 12px;
      margin-top: 10px;
      display: inline-block;
    }
    
    .gift-qr {
      width: 120px;
      height: 120px;
      border-radius: 12px;
      background: #fff;
      padding: 8px;
      margin-bottom: 8px;
    }
    
    .tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      background: #bbf7d0;
      color: #166534;
      font-size: 11px;
    }
    
    .sortable-header {
      cursor: pointer;
      user-select: none;
      position: relative;
      padding-right: 20px !important;
    }

    .sortable-header:hover {
      background-color: rgba(255,255,255,0.05);
    }

    .sortable-header::after {
      content: '‚Üï';
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      opacity: 0.5;
    }

    .sortable-header.asc::after {
      content: '‚Üë';
      opacity: 1;
    }

    .sortable-header.desc::after {
      content: '‚Üì';
      opacity: 1;
    }
    
    .stamps-progress {
      height: 10px;
      background: rgba(0,0,0,.3);
      border-radius: 5px;
      overflow: hidden;
      margin-top: 8px;
    }

    .stamps-bar {
      height: 100%;
      background: var(--venus-soft);
      width: 0%;
      transition: width 0.3s;
    }
    
    .action-card {
      background: rgba(255,255,255,.05);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 5px;
      transition: all 0.2s ease;
    }

    .action-card:hover {
      border-color: var(--venus);
      background: rgba(255,255,255,.1);
    }
    
    .birthday-list {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 15px;
      border: 1px solid var(--line);
    }
    
    .b-item {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .tag-days {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(255,255,255,0.1);
    }
    
    .gift-redeem-box {
      background: var(--bg);
      border: 1px solid var(--venus);
      padding: 20px;
      border-radius: 16px;
      text-align: center;
      margin-bottom: 20px;
    }
    
    .history-table {
      font-size: 12px;
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    .history-table th {
      text-align: left;
      color: var(--venus-soft);
      padding: 5px;
    }

    .history-table td {
      border-top: 1px solid var(--line);
      padding: 8px 5px;
    }
    
    .debug-output {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 10px;
      font-size: 12px;
      font-family: monospace;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 10px;
    }
    
    .text-venus-soft {
      color: var(--venus-soft);
    }
    
    .bg-venus {
      background-color: var(--venus);
    }
    
    .border-venus {
      border-color: var(--venus);
    }
  </style>
  
  <!-- Scripts necesarios -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body class="checking-auth">

  <!-- Navbar Bootstrap -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <img src="/assets/logo.png" alt="Venus" class="rounded me-2" width="40" height="40">
        <div>
          <h1 class="h5 mb-0">Admin ‚Äî Venus Lealtad</h1>
          <div class="text-muted small" id="me-line">Sesi√≥n iniciada</div>
        </div>
      </div>
      
      <div class="d-flex align-items-center">
        <a class="btn btn-sm btn-outline-light me-2" href="/" target="_blank" rel="noopener">
          <i class="bi bi-box-arrow-up-right me-1"></i>P√°gina clientes
        </a>
        <button id="logout" class="btn btn-sm btn-outline-light">
          <i class="bi bi-box-arrow-right me-1"></i>Cerrar sesi√≥n
        </button>
      </div>
    </div>
  </nav>

  <main class="container-fluid py-3">
    <!-- Navegaci√≥n por pesta√±as -->
    <ul class="nav nav-pills nav-pills-custom mb-4" id="adminTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
          <i class="bi bi-speedometer2 me-1"></i>Resumen
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="cards-tab" data-bs-toggle="tab" data-bs-target="#cards" type="button" role="tab">
          <i class="bi bi-credit-card me-1"></i>Tarjetas
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab">
          <i class="bi bi-gift me-1"></i>Gift Cards
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
          <i class="bi bi-gear me-1"></i>Configuraci√≥n
        </button>
      </li>
    </ul>

    <!-- Contenido de las pesta√±as -->
    <div class="tab-content" id="adminTabsContent">
      
      <!-- Pesta√±a: Resumen -->
      <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <div class="card card-custom mb-4">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
              <div>
                <h2 class="h4 mb-1">Resumen</h2>
                <p class="text-muted mb-0">Indicadores r√°pidos de tu programa de lealtad</p>
              </div>
              <div class="d-flex align-items-center gap-2 mt-2 mt-md-0">
                <select id="stats-filter" class="form-select form-select-sm form-select-custom" style="width: auto;">
                  <option value="day">Hoy</option>
                  <option value="week" selected>Esta Semana</option>
                  <option value="month">Este Mes</option>
                </select>
                <button id="btn-download-report" class="btn btn-sm btn-venus">
                  <i class="bi bi-download me-1"></i>Descargar Reporte
                </button>
              </div>
            </div>
            
            <!-- KPIs principales -->
            <div class="row g-3 mb-4">
              <div class="col-md-4">
                <div class="kpi-card">
                  <div class="kpi-label">Tarjetas totales</div>
                  <div class="kpi-value" id="kpi-total">‚Äî</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="kpi-card">
                  <div class="kpi-label">Tarjetas completas</div>
                  <div class="kpi-value" id="kpi-full">‚Äî</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="kpi-card">
                  <div class="kpi-label" id="stamps-period-label">Sellos hoy</div>
                  <div class="kpi-value" id="kpi-stamps">‚Äî</div>
                </div>
              </div>
            </div>
            
            <!-- KPIs adicionales -->
            <div class="row g-3 mb-4">
              <div class="col-md-4">
                <div class="kpi-card">
                  <div class="kpi-label" id="redeems-period-label">Canjes hoy</div>
                  <div class="kpi-value" id="kpi-redeems">‚Äî</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="kpi-card">
                  <div class="kpi-label">Promedio sellos</div>
                  <div class="kpi-value" id="kpi-avg">‚Äî</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="kpi-card">
                  <div class="kpi-label">Tasa completitud</div>
                  <div class="kpi-value" id="kpi-rate">‚Äî</div>
                </div>
              </div>
            </div>
            
            <!-- Cumplea√±os -->
            <div class="border-top border-secondary pt-4 mb-4">
              <h3 class="h5 mb-3"><i class="bi bi-balloon me-1"></i>Cumplea√±os</h3>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="birthday-list">
                    <h4 class="h6 text-danger mb-3"><i class="bi bi-balloon me-1"></i>Pasaron (15 d√≠as)</h4>
                    <div id="list-past-bd" class="small text-muted">Cargando...</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="birthday-list">
                    <h4 class="h6 text-success mb-3"><i class="bi bi-balloon-fill me-1"></i>Pr√≥ximos (15 d√≠as)</h4>
                    <div id="list-next-bd" class="small text-muted">Cargando...</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Actividad reciente -->
            <div class="border-top border-secondary pt-4 mb-4">
              <h3 class="h5 mb-3" id="activity-title"><i class="bi bi-graph-up me-1"></i>Actividad reciente (7 d√≠as)</h3>
              <div class="bg-dark bg-opacity-25 rounded-3 p-3">
                <canvas id="activity-chart" style="max-height: 200px;"></canvas>
              </div>
            </div>
            
            <!-- Top clientes -->
            <div class="border-top border-secondary pt-4 mb-4">
              <h3 class="h5 mb-3"><i class="bi bi-star me-1"></i>Top Clientes</h3>
              <div class="table-responsive">
                <table class="table table-custom table-hover">
                  <thead>
                    <tr>
                      <th>Cliente</th>
                      <th>Sellos</th>
                      <th>Estado</th>
                    </tr>
                  </thead>
                  <tbody id="top-clients">
                    <tr>
                      <td colspan="3" class="text-center py-3 text-muted">Cargando...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <!-- Estado de Wallets -->
            <div class="border-top border-secondary pt-4">
              <h3 class="h5 mb-3"><i class="bi bi-phone me-1"></i>Estado de Wallets</h3>
              <div class="row g-3 mb-3">
                <div class="col-md-4">
                  <div class="kpi-card">
                    <div class="kpi-label"><i class="bi bi-google me-1"></i>Google Wallet</div>
                    <div class="kpi-value" id="kpi-google">‚Äî</div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="kpi-card">
                    <div class="kpi-label"><i class="bi bi-apple me-1"></i>Apple Wallet</div>
                    <div class="kpi-value" id="kpi-apple">‚Äî</div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="kpi-card">
                    <div class="kpi-label"><i class="bi bi-phone me-1"></i>Dispositivos totales</div>
                    <div class="kpi-value" id="kpi-devices">‚Äî</div>
                  </div>
                </div>
              </div>
              <div class="text-center">
                <button id="btn-refresh-wallet-stats" class="btn btn-sm btn-outline-venus">
                  <i class="bi bi-arrow-clockwise me-1"></i>Actualizar estad√≠sticas
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pesta√±a: Tarjetas -->
      <div class="tab-pane fade" id="cards" role="tabpanel">
        <div class="card card-custom">
          <div class="card-body">
            <h2 class="h4 mb-2">Tarjetas de lealtad</h2>
            <p class="text-muted mb-4">Gestiona todas las tarjetas de tus clientes.</p>
            
            <div class="d-flex flex-wrap gap-2 mb-3">
              <input id="search-cards" class="form-control form-control-custom" placeholder="Buscar por ID o nombre..." style="max-width: 300px;">
              <button id="btn-search-cards" class="btn btn-venus">
                <i class="bi bi-search me-1"></i>Buscar
              </button>
              <button id="btn-reload-cards" class="btn btn-outline-venus">
                <i class="bi bi-arrow-clockwise me-1"></i>Recargar
              </button>
              <button id="btn-scan-card" class="btn btn-outline-venus">
                <i class="bi bi-camera me-1"></i>Escanear QR
              </button>
            </div>
            
            <div class="table-responsive">
              <table class="table table-custom table-hover">
                <thead>
                  <tr>
                    <th class="sortable-header" data-sort="id">ID</th>
                    <th class="sortable-header" data-sort="name">Cliente</th>
                    <th class="sortable-header" data-sort="phone">Tel√©fono</th>
                    <th class="sortable-header" data-sort="birthdate">F. Nacimiento</th>
                    <th class="sortable-header" data-sort="stamps">Sellos</th>
                    <th class="sortable-header" data-sort="max">Max</th>
                    <th class="sortable-header" data-sort="createdAt">Creada</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="cards-tbody">
                  <tr>
                    <td colspan="8" class="text-center py-3 text-muted">Cargando tarjetas...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mt-3">
              <button id="btn-prev-page" class="btn btn-sm btn-outline-venus">
                <i class="bi bi-chevron-left me-1"></i>Anterior
              </button>
              <span id="page-info" class="text-muted">P√°gina 1</span>
              <button id="btn-next-page" class="btn btn-sm btn-outline-venus">
                Siguiente<i class="bi bi-chevron-right ms-1"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pesta√±a: Gift Cards -->
      <div class="tab-pane fade" id="events" role="tabpanel">
        <div class="card card-custom">
          <div class="card-body">
            <div class="gift-redeem-box mb-4">
              <h3 class="h5 mb-3 text-venus-soft"><i class="bi bi-gift me-1"></i>Canjear Gift Card</h3>
              <div class="d-flex flex-column flex-md-row justify-content-center align-items-center gap-2 mb-2">
                <input id="redeem-code" class="form-control form-control-custom" placeholder="C√≥digo o escanear..." style="max-width: 250px;">
                <button id="btn-redeem-gift" class="btn btn-venus btn-sm">
                  Canjear
                </button>
              </div>
              <button onclick="startGiftScan()" class="btn btn-sm btn-outline-venus">
                <i class="bi bi-camera me-1"></i>Usar C√°mara
              </button>
            </div>

            <div class="mb-4">
              <h3 class="h6 text-muted mb-3"><i class="bi bi-clock-history me-1"></i>Historial Reciente</h3>
              <div class="table-responsive">
                <table class="table history-table">
                  <thead>
                    <tr>
                      <th>C√≥digo</th>
                      <th>Servicio</th>
                      <th>Cliente</th>
                      <th>Fecha</th>
                    </tr>
                  </thead>
                  <tbody id="gift-history-body">
                    <tr>
                      <td colspan="4" class="text-center py-2 text-muted">Cargando...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <hr class="my-4">
            
            <h2 class="h4 mb-2">Crear Gift Card</h2>
            <p class="text-muted mb-4">Genera una tarjeta de regalo digital con vigencia de 30 d√≠as. Podr√°s compartir el QR por WhatsApp o imprimirla.</p>
            
            <form id="gift-form" class="mb-4" style="max-width: 500px;">
              <div class="mb-3">
                <label for="gift-name" class="form-label">Nombre del cliente (opcional)</label>
                <input id="gift-name" class="form-control form-control-custom" placeholder="Ej. Ana L√≥pez">
              </div>
              <div class="mb-3">
                <label for="gift-service" class="form-label">Servicio a regalar</label>
                <input id="gift-service" class="form-control form-control-custom" required placeholder="Ej. Facial hidratante, Masaje relajante‚Ä¶">
              </div>
              <button type="submit" class="btn btn-venus">Generar Gift Card</button>
            </form>

            <div id="gift-preview-container" class="d-none">
              <div id="gift-card-visual" class="gift-card-visual">
                <div class="gift-card-content">
                  <img src="/assets/logo.png" alt="Venus" class="gift-brand-logo">
                  
                  <div class="gift-title">Venus Lealtad</div>
                  <div style="font-size: 0.9rem; opacity: 0.9;">¬°Tienes un regalo! üéÅ</div>
                  
                  <hr style="width: 50%; border: 0; border-top: 1px solid rgba(255,255,255,0.3); margin: 15px 0;">

                  <div id="gift-visual-service" class="gift-service">Servicio</div>
                  <div id="gift-visual-client" class="gift-meta">Para: Cliente</div>
                  <div id="gift-visual-date" class="gift-meta" style="font-size: 0.8rem; margin-top:0;">Vence: --/--/--</div>

                  <div class="gift-qr-container">
                    <canvas id="gift-qr"></canvas>
                  </div>
                  <div style="font-size: 10px; color: #333; margin-top: 4px; color: #fff; opacity: 0.8;">Muestra este c√≥digo</div>
                </div>
              </div>
            </div>

            <div id="gift-actions" class="d-flex flex-wrap gap-2 mt-3 d-none">
              <button type="button" id="gift-copy" class="btn btn-sm btn-outline-venus">Copiar texto</button>
              <button type="button" id="gift-whatsapp" class="btn btn-sm btn-venus">Enviar por WhatsApp</button>
              <button type="button" id="gift-whatsapp-image" class="btn btn-sm btn-venus">
                <i class="bi bi-camera me-1"></i>WhatsApp con imagen
              </button>
            </div>
            
            <div id="gift-success" class="alert alert-success mt-3 d-none">
              <i class="bi bi-check-circle me-1"></i>Gift Card generada exitosamente. Puedes enviarla por WhatsApp o compartir el texto.
            </div>
          </div>
        </div>
      </div>
      
      <!-- Pesta√±a: Configuraci√≥n -->
      <div class="tab-pane fade" id="settings" role="tabpanel">
        <div class="card card-custom">
          <div class="card-body">
            <h2 class="h4 mb-2">Configuraci√≥n</h2>
            <p class="text-muted mb-4">Env√≠a notificaciones push a todos los pases en Google Wallet.</p>
            
            <div class="bg-venus bg-opacity-10 border border-venus border-opacity-30 rounded-3 p-3 mb-4">
              <h3 class="h5 mb-3"><i class="bi bi-bell me-1"></i>Notificaciones Push</h3>
              
              <form id="push-notification-form">
                <div class="mb-3">
                  <label for="push-title" class="form-label">T√≠tulo de la notificaci√≥n</label>
                  <input id="push-title" class="form-control form-control-custom" placeholder="Ej. ¬°Nueva promoci√≥n!" required maxlength="50">
                  <div class="form-text text-muted">M√°ximo 50 caracteres</div>
                </div>
                
                <div class="mb-3">
                  <label for="push-message" class="form-label">Mensaje</label>
                  <textarea id="push-message" class="form-control form-control-custom" placeholder="Ej. Hoy tenemos 20% de descuento..." required maxlength="200" rows="3"></textarea>
                  <div class="form-text text-muted">M√°ximo 200 caracteres</div>
                </div>
                
                <div class="mb-3">
                  <label for="push-type" class="form-label">Tipo</label>
                  <select id="push-type" class="form-select form-select-custom">
                    <option value="promo">üéÅ Promoci√≥n</option>
                    <option value="reminder">‚è∞ Recordatorio</option>
                    <option value="update">‚ÑπÔ∏è Actualizaci√≥n</option>
                    <option value="alert">‚ö†Ô∏è Alerta</option>
                  </select>
                </div>
                
                <div class="mb-3 p-3 bg-dark bg-opacity-10 rounded-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="text-muted small">Vista previa:</span>
                    <span id="preview-type" class="small">üéÅ Promoci√≥n</span>
                  </div>
                  <div class="bg-dark bg-opacity-10 rounded-2 p-2">
                    <div id="preview-title" class="fw-semibold mb-1">¬°Nueva promoci√≥n!</div>
                    <div id="preview-message" class="text-muted small">Tu mensaje aparecer√° aqu√≠...</div>
                  </div>
                </div>
                
                <div class="d-flex flex-wrap gap-2">
                  <button type="button" id="btn-mass-push" class="btn btn-venus">Enviar a todos</button>
                  <button type="button" id="test-push" class="btn btn-outline-venus">Enviar prueba</button>
                </div>
              </form>
              
              <div id="push-success" class="alert alert-success mt-3 d-none">
                <i class="bi bi-check-circle me-1"></i>Notificaci√≥n enviada a <span id="push-count">0</span> pases
              </div>
              
              <div id="push-error" class="alert alert-danger mt-3 d-none">
                <i class="bi bi-exclamation-triangle me-1"></i>Error al enviar notificaci√≥n
              </div>
            </div>

            <div class="mb-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h5 mb-0"><i class="bi bi-clock-history me-1"></i>Historial</h3>
                <button id="refresh-history" class="btn btn-sm btn-outline-venus">
                  <i class="bi bi-arrow-clockwise me-1"></i>
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-custom table-hover">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>T√≠tulo</th>
                      <th>Tipo</th>
                      <th>Enviadas</th>
                      <th>Errores</th>
                    </tr>
                  </thead>
                  <tbody id="not