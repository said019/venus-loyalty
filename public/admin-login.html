<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ingresar al Panel Admin</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    :root{ --venus:#8c9668; --venus-2:#cdd8a6; --bg:#fff6e3; --ink:#1b1b1b; --line:#e5e7eb; --muted:#6b7280; --error:#b91c1c; --ok:#15803d; }
    body{ background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; }
    .wrap{ max-width:560px; margin:48px auto; padding:0 16px; }
    .topbar{ display:flex; justify-content:flex-end; gap:8px; margin-bottom:14px; }
    .btn{ background:var(--venus); color:#fff; border:0; border-radius:12px; padding:10px 14px; cursor:pointer }
    .btn.ghost{ background:#fff; color:var(--venus); border:1px solid var(--venus) }
    .card{ background:#fff; border:1px solid var(--line); border-radius:16px; padding:22px; box-shadow:0 10px 28px rgba(0,0,0,.04) }
    .h1{ display:flex; align-items:center; gap:10px; margin:0 0 10px }
    .subtitle{ color:var(--muted); margin:0 0 18px; }
    label{ display:block; font-size:14px; margin:12px 0 6px }
    input{ width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; background:#fafafa }
    .row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    .actions{ display:flex; justify-content:space-between; align-items:center; margin-top:14px }
    .muted{ color:var(--muted) }
    .link{ color:var(--venus); text-decoration:none }
    .link:hover{ text-decoration:underline }
    .alert{ border-radius:12px; padding:10px 12px; margin:12px 0 0; font-size:14px; border:1px solid }
    .alert--error{ background:#fff1f1; color:var(--error); border-color:#f3c7c7 }
    .alert--ok{ background:#f0fff4; color:var(--ok); border-color:#b7ebc6 }
    dialog{ border:none; border-radius:14px; padding:16px; width:92%; max-width:460px }
    dialog h3{ margin:0 0 8px }
    dialog .btnrow{ display:flex; justify-content:flex-end; gap:8px; margin-top:12px }
  </style>
</head>
<body>
  <main class="wrap">
    <div class="topbar">
      <a class="btn ghost" href="/" target="_blank" rel="noopener">Página clientes</a>
      <a class="btn ghost" href="/staff.html" target="_blank" rel="noopener">Página staff</a>
    </div>

    <section class="card">
      <h1 class="h1">
        <img src="/assets/logo.png" alt="Venus" style="width:38px;height:38px;border-radius:10px">
        Ingresar al Panel Admin
      </h1>
      <p class="subtitle">Introduce tus credenciales para entrar al panel.</p>

      <form id="form-login">
        <label>Email</label>
        <input id="email" type="email" placeholder="tucorreo@dominio.com" autocomplete="username" required>
        <label>Contraseña</label>
        <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" required>

        <div class="actions">
          <div class="muted">
            ¿No tienes cuenta?
            <a class="link" href="/admin.html#register">Crear una</a>
          </div>
          <div class="row">
            <a id="forgot" class="link" href="#">Olvidé mi contraseña</a>
            <button class="btn" type="submit">Entrar</button>
          </div>
        </div>

        <div id="out" class="alert" style="display:none"></div>
      </form>
    </section>
  </main>

  <!-- Modal: Olvidé mi contraseña -->
  <dialog id="dlg-forgot">
    <h3>Recuperar contraseña</h3>
    <p class="muted" style="margin:0 0 10px">Te enviaremos un enlace para restablecerla.</p>
    <label>Email</label>
    <input id="fmail" type="email" placeholder="tucorreo@dominio.com" required>
    <div id="fout" class="alert" style="display:none"></div>
    <div class="btnrow">
      <button id="fclose" class="btn ghost" type="button">Cerrar</button>
      <button id="fsend" class="btn" type="button">Enviar</button>
    </div>
  </dialog>

  <script>
    const $ = (s, x=document)=>x.querySelector(s);
    const out = $('#out');

    function showAlert(el, msg, kind='error'){
      el.textContent = msg;
      el.className = 'alert ' + (kind==='ok' ? 'alert--ok' : 'alert--error');
      el.style.display = 'block';
    }

    async function postJSON(url, data){
      const r = await fetch(url, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(data||{})
      });
      const j = await r.json().catch(()=>({}));
      if(!r.ok) throw new Error(j.error || 'Error');
      return j;
    }

    // Login
    $('#form-login')?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      out.style.display = 'none';
      try{
        await postJSON('/api/admin/login', {
          email: $('#email').value.trim(),
          password: $('#password').value
        });
        location.href = '/admin';
      }catch(err){
        showAlert(out, 'Credenciales inválidas', 'error');
      }
    });

    // Forgot password
    const dlg = $('#dlg-forgot');
    $('#forgot')?.addEventListener('click', (e)=>{ e.preventDefault(); $('#fmail').value=$('#email').value; dlg.showModal(); });
    $('#fclose')?.addEventListener('click', ()=> dlg.close());
    $('#fsend')?.addEventListener('click', async ()=>{
      const fout = $('#fout');
      fout.style.display='none';
      try{
        await postJSON('/api/admin/forgot', { email: $('#fmail').value.trim() });
        showAlert(fout, 'Si el correo existe, hemos enviado un enlace de recuperación.', 'ok');
      }catch(err){
        // responder lo mismo para no filtrar usuarios
        showAlert(fout, 'Si el correo existe, hemos enviado un enlace de recuperación.', 'ok');
      }
    });
  </script>
</body>
</html>